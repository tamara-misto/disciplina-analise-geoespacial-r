<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Introdução à análise geoespacial com R    </title>
    <meta charset="utf-8" />
    <meta name="author" content="Maurício H. Vancine   Milton C. Ribeiro" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis-fonts.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/fontawesome-all.min.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Introdução à análise geoespacial com R <br><br><br>
## 4 Introdução ao tidyverse <br><br><br>
### Maurício H. Vancine <br> Milton C. Ribeiro
### 20/10/2020

---




class: clear
background-image: url(img/general_data_science_r4ds.png)
background-size: 800px

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

Fonte: [@allison_horst](https://twitter.com/allison_horst)

---

background-image: url(img/tidyverse_celestial.png)
background-size: 400px
background-position: 85% 75%

# 4 tidyverse

## Conteúdo
1. tidyverse
1. magrittr (pipe - %&gt;%)
1. readr
1. readxl e writexl
1. tibble
1. tidyr
1. dplyr
1. stringr
1. forcats
1. lubridate
1. purrr

&lt;br&gt;&lt;br&gt;

Fonte: [@allison_horst](https://twitter.com/allison_horst)

---

# 4 tidyverse

## Script

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

## .center[`04_script_intro_geocomp_r.R`]

---

class: clear
background-image: url(img/package_tidyverse.png)
background-size: 400px

---

# 4.1 tidyverse

### O tidyverse é um **conjunto de pacotes** designados para **Data Science**

&lt;br&gt;

--

### Todos os pacotes compartilham uma **filosofia** de design, gramática e estruturas de dados

&lt;br&gt;

--

### É um **"dialeto"** novo para a linguagem R

&lt;br&gt;

--

### **tidy**: organizado, arrumado, ordenado

### **verse**: universo

---

class: inverse, center
background-image: url(img/gif_avenger_reference.gif)
background-size: 800px

# Iniciativa Vingadores do R

---

background-image: url(img/general_data_science.png)
background-size: 700px
background-position: 50% 60%

# 4.1 tidyverse

## Workflow

---

background-image: url(img/tidyverse_flow.png)
background-size: 650px
background-position: 50% 60%

# 4.1 tidyverse

## Pacotes

---

background-image: url(img/tidyverse_packages.png)
background-size: 650px
background-position: 50% 60%

# 4.1 tidyverse

## Pacotes e suas funções

---

background-image: url(img/general_messy_data.png)
background-size: 700px
background-position: 50% 70%

# 4.1 tidyverse

## Objetivo: te ajudar na luta contra os dados

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

Fonte: [@ViviFabrien](https://twitter.com/ViviFabrien)

---

background-image: url(img/person_hadley_wickham.jpg)
background-size: 550px
background-position: 50% 60%

# 4.1 tidyverse

### O idealizador foi o **Hadley Wickham** e atualmente **muitas pessoas** têm contribuído para sua expansão

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] http://hadley.nz/

---

background-image: url(img/tidyverse_papers.png)
background-size: 400px
background-position: 50% 90%

# tidyverse

## Artigos
&gt; - Wickham, Hadley. ["Tidy data."](https://www.jstatsoft.org/article/view/v059i10) Journal of Statistical Software 59.10 (2014): 1-23.

&gt; - Wickham, Hadley, et al. ["Welcome to the Tidyverse."](https://joss.theoj.org/papers/10.21105/joss.01686) Journal of Open Source Software 4.43 (2019): 1686.

---

background-image: url(img/cover_data_science_r.png)
background-size: 300px
background-position: 50% 55%

# 4.1 tidyverse

## R for Data Science (2017)

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://r4ds.had.co.nz/

---

background-image: url(img/tidyverse_site1.png)
background-size: 800px
background-position: 50% 50%

# 4.1 tidyverse

## Sites

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://www.tidyverse.org/

---

background-image: url(img/tidyverse_site2.png)
background-size: 800px
background-position: 50% 50%

# 4.1 tidyverse

## Sites

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://rpubs.com/modelthinkingbr/dados

---

# 4.1 tidyverse

### Para utilizar os pacotes do **tidyverse** é preciso instalar e carregar o pacote `tidyverse`


```r
# instalar o pacote
install.packages("tidyverse")
```

--


```r
# carregar o pacote
library(tidyverse)
```

---

# 4.1 tidyverse

## Listar todos os pacotes do tidyverse

&lt;br&gt;&lt;br&gt;


```r
# list all packages in the tidyverse 
tidyverse::tidyverse_packages(include_self = TRUE)
```

---

background-image: url(img/code_snake_case.png)
background-size: 500px
background-position: 80% 80%

# 4.1 tidyverse

## IMPORTANTE!

### Todas as funções dos pacotes **tidyverse** usão fonte minúscula e usam `_` para separar os nomes internos das funções (snake_code)

&lt;br&gt;

`read_csv()`

`read_xlsx()`

`as_tibble()`

`left_join()`

`group_by()`

---

class: clear
background-image: url(img/package_magrittr.png)
background-size: 400px

---

background-image: url(img/person_rene_magritte.jpg), url(img/tidyverse_magritte_pipe.jpg)
background-size: 250px, 500px
background-position: 10% 30%, 85% 75%

# 4.2 magrittr (pipe - %&gt;%)

## René Magritte (1898-1967)

---

# 4.2 magrittr (pipe - %&gt;%)

### O operador pipe (*%&gt;%*) permite o “encadeamento” de várias funções e **não é preciso de objetos** para armazenar resultados intermediários

--

### Essa função torna os códigos em R **mais simples**, pois realizamos **múltiplas operações** em uma **única linha**

--

### Ele captura o **resultado de uma declaração** e o **torna a entrada da próxima declaração**. Podemos pensar como *“EM SEGUIDA FAÇA”*

--

### O operador pipe é **%&gt;%**

---

# 4.2 magrittr (pipe - %&gt;%)

### Atalho: `Crtl + Shift + M`

```r
# sem pipe
sqrt(sum(1:100))
```

--

background-image: url(img/general_fog01.jpg)
background-size: 500px
background-position: 50% 80%

---

background-image: url(img/general_fog02.jpg)
background-size: 350px
background-position: 50% 90%

# 4.2 magrittr (pipe - %&gt;%)

### Atalho: `crtl + shift + M`

```r
# sem pipe
sqrt(sum(1:100))
```

---

# 4.2 magrittr (pipe - %&gt;%)

### Atalho: `crtl + shift + M`

```r
# sem pipe
sqrt(sum(1:100))
```


```r
# com pipe
1:100 %&gt;% 
  sum() %&gt;% 
  sqrt()
```

---

class: clear, inverse
background-image: url(img/gif_uou.webp)
background-size: 800px

---

# 4.2 magrittr (pipe - %&gt;%)

### Atalho: `crtl + shift + M`

```r
# fixar amostragem
set.seed(42)

# sem pipe
ve &lt;- sum(sqrt(sort(log10(rpois(100, 10)))))
ve
```
--

```r
# fixar amostragem
set.seed(42)

# com pipe
ve &lt;- rpois(100, 10) %&gt;% 
  log10() %&gt;%
  sort() %&gt;% 
  sqrt() %&gt;% 
  sum()
ve  
```

---

class: clear, inverse
background-image: url(img/gif_mario.gif)
background-size: 700px

---

class: inverse, center, middle

# Exercícios

---

# Exercício 09

## Reescreva cada uma das operações utilizando pipes `%&gt;%`:
&lt;br&gt;
`log10(cumsum(1:100))`
&lt;br&gt;
`sum(sqrt(rnorm(100)))`
&lt;br&gt;
`prod(sort(sample(1:10, 10000, rep = TRUE)))`



---

# Exercício 09
## Solução

```r
# solucao
# 1.
log10(cumsum(1:100))

1:100 %&gt;%
  cumsum %&gt;% 
  log10
```

---

# Exercício 09
## Solução
  

```r
# 2.
sum(sort(rnorm(100)))

100 %&gt;% 
  rnorm %&gt;% 
  sort %&gt;% 
  sum
```

---

# Exercício 09
## Solução


```r
# 3.
scale(sample(1:10, 10000, rep = TRUE))

1:10 %&gt;% 
  sample(10000, rep = TRUE) %&gt;% 
  scale
```

---

class: inverse, center, middle

# Dúvidas?

---

class: clear
background-image: url(img/package_readr.png)
background-size: 400px

---

background-image: url(img/cheatsheet_readr.png)
background-size: 600px
background-position: 50% 50%

# 4.3 readr

## Data Import Cheatsheet

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://github.com/rstudio/cheatsheets/raw/master/data-import.pdf

---

# 4.3 readr

### **Carrega e salva** grandes arquivos de forma **mais rápida**

--

### As funções **read.csv()** e **read.csv2()** são substituídas pelas funções **read_csv()** e **read_csv2()**

--

### Essas funções fornecem **medidores de progresso**

--

### E também **classificam** automaticamente o **modo** dos dados de cada coluna

--

### A classe do objeto atribuído é **tibble**

--

### Para salvar arquivos no formato .csv: **write_csv()** e **write_csv2()**

---

background-image: url(img/general_data_eu_mesmo.png)
background-size: 600px
background-position: 50% 80%

# 4.3 readr

## ATLANTIC AMPHIBIANS: a dataset of amphibian communities from the Atlantic Forests of South America

### Eu mesmo et al. (2018)

---

class: inverse, center, middle

# Mas antes, uma outra forma de definir diretórios

---

class: clear
background-image: url(img/here.png)
background-size: 700px

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

Fonte: [@allison_horst](https://twitter.com/allison_horst)

---

# here

## Constrói caminhos para os arquivos do seu projeto

&lt;br&gt;

### - **Mudar o diretório**: tende à ser chato demais (principalmente se é um código alheio)
### - **Fragilidade**: conectado exatamente a um lugar e a um momento (baixa reprodutibilidade)
### - **Subdiretórios**: facilita importar ou exportar para subpastas (Lei do Mínimo Esforço)

---

background-image: url(img/here.png)
background-size: 400px
background-position: 50% 90%

# here

## Pacote

```r
# install
install.packages("here")

# load
library(here)
```

&lt;br&gt;&lt;br&gt;&lt;br&gt;

Fonte: [@allison_horst](https://twitter.com/allison_horst)

---

background-image: url(img/here.png)
background-size: 400px
background-position: 50% 90%

# here

## Diversos critérios para encontrar o diretório raiz


```r
# confer
here::here()

# create a .here file
here::set_here()
```

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

Fonte: [@allison_horst](https://twitter.com/allison_horst)

---

class: inverse, center, middle

# Agora sim, vamos importar os dados usando o here::here()

---

# readr

## **Formato .csv**

```r
# import sites
si &lt;- readr::read_csv(here::here("03_dados", "tabelas", "ATLANTIC_AMPHIBIANS_sites.csv"))
si
```

---

class: inverse, center, middle

# Ou não...

---

# readr

## **Formato .csv**

```r
# import sites
si &lt;- readr::read_csv("./03_dados/tabelas/ATLANTIC_AMPHIBIANS_sites.csv")
si
```



---

# 4.3 readr

## **Formato .txt**

```r
# import sites
si &lt;- readr::read_tsv(here::here("03_dados", "tabelas", "ATLANTIC_AMPHIBIANS_sites.txt"))
si
```

---

class: clear
background-image: url(img/package_readxl.png)
background-size: 400px

---

# 4.4 readxl e writexl

## São pacotes à parte do **tidyverse** para importar planilhas no formato Excel®

&lt;br&gt;&lt;br&gt;


```r
# import .xlsx
install.packages("readxl")
library("readxl")
```

&lt;br&gt;
--



```r
# export .xlsx
install.packages("writexl")
library("writexl")
```

---

# 4.4 readxl e writexl

### **Carrega e salva** grandes arquivos de forma **mais rápida** no formato **.xlsx**

--

### Funções **read_xlsx()** e **read_xlsx2()**

--

### Essas funções fornecem **medidores de progresso**

--

### E também **classificam** automaticamente o **modo** dos dados de cada coluna

--

### A classe do objeto atribuído é **tibble**

--

### Para salvar arquivos no formato .xlsx: **write_xlsx()** e **write_xlsx2()**

---

# 4.4 readxl e writexl

## **Formato .xlsx**

### O argumento `sheet` define a aba a ser importada (número ou nome)


```r
# import sites
si &lt;- readxl::read_xlsx(here::here("03_dados", "tabelas", "ATLANTIC_AMPHIBIANS_sites.xlsx"), 
                        sheet = 1)
si
```

---

background-image: url(img/gif_frog.gif)
background-size: 200px
background-position: 50% 100%

# Importar os dados

## **Formato .csv**

### Matriz de localidades



```r
# import sites
si &lt;- readr::read_csv(here::here("03_dados", "tabelas", "ATLANTIC_AMPHIBIANS_sites.csv"))
si
```

### Matriz de espécies



```r
# import species
sp &lt;- readr::read_csv(here::here("03_dados", "tabelas", "ATLANTIC_AMPHIBIANS_species.csv"))
sp
```

---

class: clear
background-image: url(img/package_tibble.png)
background-size: 400px

---

# 4.5 tibble

### O tibble (classe *tbl_df*) é um **tipo especial de data frame**

--

### É o **formato** aconselhado para que as funções do tidyverse **funcionem**

--

### Converter **data frame** em **tibble** usa-se a função `as_tibble()`

--

### Converter **tibble** em **data frame** usa-se a função `as_data_frame()`

--

### Cada variável pode ser do modo *numbers(int, dbl)*, *character(chr)*, *logical(lgl)* ou *factor(fctr)*

---

# 4.5 tibble

## Descrição dos modos das colunas através da função `glimpse()` - "espiar os dados"


```r
tibble::glimpse(si)
```

---

# 4.5 tibble

## Descrição dos modos das colunas através da função `glimpse()` - "espiar os dados"


```r
tibble::glimpse(sp)
```

---

# 4.5 tibble

## tibble vs data.frame

### 1. Nunca converte um tipo **character como factor** (R 4.0.x)

```r
df &lt;- data.frame(ch = c("a", "b"), nu = 1:2)
str(df)
```
--

```r
tb &lt;- tibble::tibble(ch = c("a", "b"), nu = 1:2)
tibble::glimpse(tb)
```

---

# 4.5 tibble

## tibble vs data.frame

### 2. A indexação com colchetes retorna um **tibble**

```r
df_ch &lt;- df[, 1]
class(df_ch)
```
--

```r
tb_ch &lt;- tb[, 1]
class(tb_ch)
```
--

```r
# indexacao pelo nome devolve um vetor
tb_ch &lt;- tb$ch
class(tb_ch)
```

---

# 4.5 tibble

## tibble vs data.frame

### 3. Não faz correspondência parcial, retorna **NULL** se a coluna não existe com o nome especificado

```r
df$c 
```
--

```r
tb$c
```

---

class: clear
background-image: url(img/package_tidyr.png)
background-size: 400px

---

background-image: url(img/cheatsheet_tidyr.png)
background-size: 600px
background-position: 50% 50%

# 4.6 tidyr

## Data Import Cheatsheet

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://github.com/rstudio/cheatsheets/raw/master/data-import.pdf

---

# 4.6 tidyr

### Os conjuntos de dados **tidy** (organizados) são fáceis de manipular, modelar e visualizar

--

### Um conjunto de dados está **arrumado ou não**, dependendo de como linhas, colunas e células são combinadas com observações, variáveis e valores

--

## Nos dados tidy:
### 1. Cada variável em uma coluna
### 2. Cada observação em uma linha
### 3. Cada valor como uma célula

---

background-image: url(img/tidyr_data01.png)
background-size: 800px
background-position: 50% 50%

# 4.6 tidyr

## Conjuntos de dados 'tidy'

---

background-image: url(img/tidyr_data02.jpg)
background-size: 500px
background-position: 70% 85%

# 4.6 tidyr

## Funções

1. **unite()**: junta dados de múltiplas colunas em uma
1. **separate()**: separa caracteres em múlplica colunas
1. **separate_rows()**: separa caracteres em múlplica colunas e linhas
1. **drop_na()**: retira linhas com NA
1. **replace_na()**: substitui NA
1. **pivot_wider()**: long para wide
1. **pivot_longer()**: wide para long

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

Fonte: [@allison_horst](https://twitter.com/allison_horst)

---

background-image: url(img/tidyr_unite.png)
background-size: 800px
background-position: 50% 50%

# 4.6 tidyr

---

# 4.6 tidyr

## **1 unite**

### Unir as colunas latirude e longitude separadas por uma vírgula

```r
# sem pipes
si_unite &lt;- tidyr::unite(si, "lat_lon", latitude:longitude, sep = ",")
si_unite$lat_lon
```

---

# 4.6 tidyr

## **1 unite**

### Unir as colunas latirude e longitude separadas por uma vírgula

```r
# com pipes
si_unite &lt;- si %&gt;% 
  tidyr::unite("lat_lon", latitude:longitude, sep = ",")
si_unite$lat_lon
```

---

background-image: url(img/tidyr_separate.png)
background-size: 800px
background-position: 50% 50%

# 4.6 tidyr

---

# 4.6 tidyr

## **2 separate**

### Separar os dados de "period" em quatro colunas dos seus valores

```r
si_separate &lt;- si %&gt;% 
  tidyr::separate("period", c("mo", "da", "tw", "ni"), remove = FALSE)
si_separate[, c(1, 9:13)]
```

---

# 4.6 tidyr

## **3 separate_rows()**

### Separar os dados de "period" na mesma coluna e repetindo os valores

```r
si_separate_row &lt;- si %&gt;% 
  tidyr::separate_rows("period")
si_separate_row[, c(1, 9:13)]
```

---

# 4.6 tidyr

## **4 drop_na()**

### Remove as linhas com NA de todas as colunas

```r
si_drop_na &lt;- si %&gt;% 
  tidyr::drop_na()
si_drop_na
```

---

# 4.6 tidyr

## **4 drop_na()**

### Remove as linhas com NA da coluna "active_methods"

```r
si_drop_na &lt;- si %&gt;% 
  tidyr::drop_na(active_methods)
si_drop_na
```

---

# 4.6 tidyr

## **5 replace_na()**

### Substituir os NAs da coluna "active_methods" por 0 

```r
si_replace_na &lt;- si %&gt;% 
  tidyr::replace_na(list(active_methods = 0))
si_replace_na
```

---

background-image: url(img/gif_tidyr_pivot.gif),url(img/tidyr_tb_pivot.png)
background-size: 300px,550px
background-position: 10% 90%,90% 40%

# 4.6 tidyr

## Pivotar os dados

---

background-image: url(img/tidyr_pivot_wider.png)
background-size: 800px
background-position: 50% 50%

# 4.6 tidyr

---

# 4.6 tidyr

## **6 pivot_wider()** 

### Long para wide

1. **id_cols**: variável id
2. **names_from**: variável categórica que irá definir os nomes das colunas
3. **values_from**: variável numérica que irá preencher os dados
4. **values_fill**: valor para preencher os NAs


```r
si[, c("id", "record", "species_number")]
```

---

# 4.6 tidyr

## **6 pivot_wider()** 

### Long para wide

1. **id_cols**: variável id
2. **names_from**: variável categórica que irá definir os nomes das colunas
3. **values_from**: variável numérica que irá preencher os dados
4. **values_fill**: valor para preencher os NAs


```r
si_wide &lt;- si %&gt;% 
  tidyr::pivot_wider(id_cols = id, 
                     names_from = state_abbreviation,
                     values_from = species_number, 
                     values_fill = list(species_number = 0))
si_wide
```

---

# 4.6 tidyr

## **6 pivot_wider()** 

### Long para wide

1. **id_cols**: variável id
2. **names_from**: variável categórica que irá definir os nomes das colunas
3. **values_from**: variável numérica que irá preencher os dados
4. **values_fill**: valor para preencher os NAs


```r
sp[1:1000, c("id", "species", "individuals")]
```

---

# 4.6 tidyr

## **6 pivot_wider()** 

### Long para wide

1. **id_cols**: variável id
2. **names_from**: variável categórica que irá definir os nomes das colunas
3. **values_from**: variável numérica que irá preencher os dados
4. **values_fill**: valor para preencher os NAs


```r
sp_wide &lt;- sp[1:1000, ] %&gt;% 
  tidyr::replace_na(list(individuals = 0)) %&gt;% 
  tidyr::pivot_wider(id_cols = id, 
                     names_from = species, 
                     values_from = individuals, 
                     values_fill = list(individuals = 0))
sp_wide
```

---

background-image: url(img/tidyr_pivot_longer.png)
background-size: 800px
background-position: 50% 50%

# 4.6 tidyr

---

# 4.6 tidyr

## **7 pivot_longer()**

### Wide para long

1. **cols**: coluna do id
2. **names_to**: nome da coluna que receberá os nomes
3. **values_to**: nome da coluna que receberá os valores


```r
si_long &lt;- si_wide %&gt;% 
  tidyr::pivot_longer(cols = -id, 
                      names_to = "record", 
                      values_to = "species_number")
si_long
```

---

class: inverse, center, middle

# Exercícios

---

# Exercício 10
### Combine as colunas `country`, `state`, `state_abbreviation`, `municipality`, `site`, em uma coluna chamada `local_total` separadas por `, (vírgula + espaço)`, atribuindo o resultado a um novo objeto, utilizando o formato tidyverse



---

# Exercício 10
## Solução

```r
si_local &lt;- si %&gt;% 
  tidyr::unite("local_total", 
               c(country, state, state_abbreviation, municipality, site), 
               sep = ", ")
si_local$local_total
```

---

# Exercício 11
### Quanto indivíduos por há por família nos locais amostrados? Apenas para as 1000 primeiras linhas da tabela `sp`


---

# Exercício 11
## Solução

```r
family_wide &lt;- sp[1:1000, ] %&gt;% 
  tidyr::replace_na(list(individuals = 0)) %&gt;% 
  tidyr::drop_na(family) %&gt;% 
  tidyr::pivot_wider(id_cols = id, 
                     names_from = family, 
                     values_from = individuals, 
                     values_fn = list(individuals = sum),
                     values_fill = list(individuals = 0))
family_wide
```

---

class: inverse, center, middle

# Dúvidas?

---

class: clear
background-image: url(img/package_dplyr.png)
background-size: 400px

---

class: clear
background-image: url(img/dplyr_wrangling.png)
background-size: 600px

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

Fonte: [@allison_horst](https://twitter.com/allison_horst)

---

background-image: url(img/cheatsheet_dplyr.png)
background-size: 600px
background-position: 50% 50%

# 4.7 dplyr

## Data Transformation Cheatsheet

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf

---

# 4.7 dplyr

&lt;br&gt;

### O **dplyr** é um pacote que **facilita** o trabalho com dados, com uma **gramática de manipulação** de dados **simples e flexível** (filtragem, reordenamento, seleção, entre outras)

&lt;br&gt;
--

### Ele foi construído com o intuito de obter uma forma **mais rápida** e **expressiva** de tratar os dados 

&lt;br&gt;
--

### O **tibble** é a **versão de data frame** mais **conveniente** para **se usar** com dplyr

---

# 4.7 dplyr

### Sua gramática simples contém **funções verbais** para manipulação de dados

--

&lt;br&gt;&lt;br&gt;

## Funções

- Verbos: mutate(), select(), filter(), arrange(), summarise(), slice(), rename(), etc.

- Sufixos: _at(), _if(), _all(), etc.

- Agrupamento: group_by() e ungroup()

- Junções: inner_join(), full_join(), left_join() e right_join()

- Funções resumo: n(), n_distinct(), first(), last(), nth(), etc.


---

# 4.7 dplyr

### Sua gramática simples contém **funções verbais** para manipulação de dados

&lt;br&gt;

1. **select()**: seleciona colunas pelo nome gerando um tibble&lt;br&gt;
1. **pull()**: seleciona uma coluna como vetor&lt;br&gt;
1. **rename()**: muda o nome das colunas&lt;br&gt;
1. **mutate()**: adiciona novas colunas ou adiciona resultados em colunas existentes&lt;br&gt;
1. **arrange()**: reordenar as linhas com base nos valores de colunas&lt;br&gt;
1. **filter()**: seleciona linhas com base em valores&lt;br&gt;
1. **distinct()**: remove linhas com valores repetidos com base nos valores de colunas&lt;br&gt;
1. **slice()**: seleciona linhas pelos números&lt;br&gt;
1. **sample_n()**: amostragem aleatória de linhas&lt;br&gt;
1. **summarise()**: agrega ou resume os dados através de funções, podendo considerar valores das colunas&lt;br&gt;
1. **_join()**: junta dados de duas tabelas através de uma coluna chave

---

# 4.7 dplyr

### O **tibble** é sempre o **primeiro argumento** das funções verbais

--

### Todas seguem a mesma sintaxe: 

#### 1. tibble
#### 2. operador pipe 
#### 3. nome da função verbal com os argumentos entre parênteses 

--

&lt;br&gt;

### As funções verbais **não modificam** o tibble original


```r
tb_dplyr &lt;- tb %&gt;% 
  funcao_verbal(argumento1, argumento2)
```

---

background-image: url(img/dplyr_select.png)
background-size: 800px
background-position: 50% 50%

# 4.7 dplyr

## **1 select**

---

# 4.7 dplyr

## **1 select**

### Seleciona colunas pelo nome


```r
si_select &lt;- si %&gt;% 
  dplyr::select(id, longitude, latitude)
si_select
```

---

# 4.7 dplyr

## **1 select**

### Remove as colunas pelo nome


```r
si_select &lt;- si %&gt;% 
  dplyr::select(-c(id, longitude, latitude))
si_select
```
---

# 4.7 dplyr

## **1 select**

### Seleciona colunas por um padrão


```r
#  starts_with(), ends_with() e contains()
si_select &lt;- si %&gt;% 
  dplyr::select(contains("sp"))
si_select
```

---

background-image: url(img/dplyr_pull.png)
background-size: 800px
background-position: 50% 50%

# 4.7 dplyr

## **2 pull**

### Seleciona uma coluna como vetor

---

# 4.7 dplyr

## **2 pull**

### Seleciona uma coluna como vetor


```r
# coluna para vetor
si_pull &lt;- si %&gt;% 
  dplyr::pull(id)
si_pull
```

---

# 4.7 dplyr

## **2 pull**

### Seleciona uma coluna como vetor


```r
# coluna para vetor
si_pull &lt;- si %&gt;% 
  dplyr::pull(species_number)
si_pull
```

---

# 4.7 dplyr

## **3 rename**

### Renomeia colunas

```r
# rename sp column
si_rename &lt;- si %&gt;%
  dplyr::rename(sp = species_number)
si_rename
```

---

background-image: url(img/dplyr_mutate.png)
background-size: 800px
background-position: 50% 50%

# 4.7 dplyr

## **4 mutate**

---

# 4.7 dplyr

## **4 mutate**

### Adiciona colunas novas ou vindas de operações

```r
# add column record as factor
si_mutate &lt;- si %&gt;% 
  dplyr::mutate(record_factor = as.factor(record))
si_mutate$record_factor
```

---

background-image: url(img/dplyr_arrange.png)
background-size: 800px
background-position: 50% 50%

# 4.7 dplyr

## **5 arrange**

---

# 4.7 dplyr

## **5 arrange**

### Ordenar de forma crescente pela coluna **species_number**

```r
si_arrange &lt;- si %&gt;% 
  dplyr::arrange(species_number)
si_arrange
```

---

# 4.7 dplyr

## **5 arrange**

### Ordenar de forma decrescente pela coluna **species_number**

```r
si_arrange &lt;- si %&gt;% 
  dplyr::arrange(desc(species_number))
si_arrange
```

---

# 4.7 dplyr

## **5 arrange**

### Ordenar de forma decrescente pela coluna **species_number**

```r
si_arrange &lt;- si %&gt;% 
  dplyr::arrange(-species_number)
si_arrange
```

---

background-image: url(img/dplyr_filter.png)
background-size: 800px
background-position: 50% 50%

# 4.7 dplyr

## **6 filter**

---

# 4.7 dplyr

## **6 filter** 

### operadores: &gt;, &gt;=, &lt;, &lt;=, ==, !=, is.na, !is.na, %in%
### Filtrar para locais com mais de 5 espécies

```r
si_filter &lt;- si %&gt;% 
  dplyr::filter(species_number &gt; 5)
si_filter
```

--

### Filtrar para locais centre 1 e 5 espécies

```r
si_filter &lt;- si %&gt;% 
  dplyr::filter(between(species_number, 1, 5))
si_filter
```

---

# 4.7 dplyr

## **6 filter** 
### Filtrar para locais com NA no métodos passivos

```r
si_filter &lt;- si %&gt;% 
  dplyr::filter(is.na(passive_methods))
si_filter
```
--
### Filtrar para locais sem NA no métodos passivos

```r
si_filter &lt;- si %&gt;% 
  dplyr::filter(!is.na(passive_methods))
si_filter
```

---

# 4.7 dplyr

## **6 filter** 
### Filtrar para locais sem NA no métodos ativos **E** passivos

```r
si_filter &lt;- si %&gt;% 
  dplyr::filter(!is.na(active_methods) &amp; !is.na(passive_methods))
si_filter
```

---

# 4.7 dplyr

## **6 filter** 
### Filtrar para locais amostrados com mais de 5 espécies **E** em São Paulo

```r
si_filter &lt;- si %&gt;% 
  dplyr::filter(species_number &gt; 5 &amp; state_abbreviation == "BR-SP") 
si_filter
```
--
### Filtrar para locais amostrados com mais de 5 espécies **OU** em São Paulo

```r
si_filter &lt;- si %&gt;% 
  dplyr::filter(species_number &gt; 5 | state_abbreviation == "BR-SP")
si_filter
```

---

# 4.7 dplyr

## **7 distinct**
### Remove linhas duplicadas considerando a coluna número de espécies

```r
si_distinct &lt;- si %&gt;% 
  dplyr::distinct(species_number)
si_distinct
```

---

# 4.7 dplyr

## **7 distinct**
### Remove linhas duplicadas considerando a coluna número de espécies e mantém as demais

```r
si_distinct &lt;- si %&gt;% 
  dplyr::distinct(species_number, .keep_all = TRUE)
si_distinct
```

---

# 4.7 dplyr

## **8 slice** 
### Selecionar linhas 1 a 10

```r
si_slice &lt;- si %&gt;% 
  dplyr::slice(1:10)
si_slice
```

---

# 4.7 dplyr

## **9 n_sample** 

### Amostrar 100 linhas aleatoriamente

```r
si_sample_n &lt;- si %&gt;% 
  dplyr::sample_n(100)
si_sample_n
```

---

background-image: url(img/dplyr_summarize.png)
background-size: 800px
background-position: 50% 50%

# 4.7 dplyr

## **10 summarise**

---

# 4.7 dplyr

## **10 summarise**

### Média e desvio padrão do número de espécies total


```r
si_summarise &lt;- si %&gt;% 
  dplyr::summarise(mean_sp = mean(species_number), 
                   sd_sp = sd(species_number))
si_summarise
```

---

# 4.7 dplyr

## **10 summarise**
### Média e desvio padrão do número de espécies por país

```r
si_summarise_group &lt;- si %&gt;% 
  dplyr::group_by(country) %&gt;% 
  dplyr::summarise(mean_sp = mean(species_number), 
                   sd_sp = sd(species_number))
si_summarise_group
```

---

background-image: url(img/dplyr_join.png)
background-size: 350px
background-position: 50% 60%

# 4.7 dplyr

## **11 *_join**

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://rpubs.com/williamsurles/293454

---

background-image: url(img/gif_dplyr_left_join.gif)
background-size: 300px
background-position: 20% 10%

# 4.7 dplyr

## **11 *_join**

---

background-image: url(img/gif_dplyr_left_join.gif),url(img/gif_dplyr_right_join.gif)
background-size: 300px,300px
background-position: 20% 10%,80% 10%

# 4.7 dplyr

## **11 *_join**

---

background-image: url(img/gif_dplyr_left_join.gif),url(img/gif_dplyr_right_join.gif),url(img/gif_dplyr_inner_join.gif)
background-size: 300px,300px,300px
background-position: 20% 10%,80% 10%,20% 100%

# 4.7 dplyr

## **11 *_join**

---

background-image: url(img/gif_dplyr_left_join.gif),url(img/gif_dplyr_right_join.gif),url(img/gif_dplyr_inner_join.gif),url(img/gif_dplyr_full_join.gif)
background-size: 300px,300px,300px,300px
background-position: 20% 10%,80% 10%,20% 100%,80% 105%

# 4.7 dplyr

## **11 *_join**

---

background-image: url(img/dplyr_leftjoin.png), url(img/dplyr_rightjoin.png), url(img/dplyr_innerjoin.png), url(img/dplyr_fulljoin.png)
background-size: 600px, 600px, 600px, 600px
background-position: 50% 20%, 50% 45%, 50% 70%, 50% 95%

# 4.7 dplyr

## **11 *_join**

---

background-image: url(img/dplyr_semijoin.png), url(img/dplyr_antijoin.png)
background-size: 700px, 700px
background-position: 50% 40%, 50% 80%

# 4.7 dplyr

## **11 *_join**

---

background-image: url(img/dplyr_leftjoin.png)
background-size: 800px
background-position: 50% 50%

# 4.7 dplyr

## **11 *_join**

---

# 4.7 dplyr

## **11 *_join**

## Adicionar longitute e latitude na tabela de espécies

### Selecionar as colunas que preciso da tabela **si**

```r
si_coord &lt;- si %&gt;% 
  select(id, longitude, latitude)
si_coord 
```

---

# 4.7 dplyr

## **11 *_join**

## Adicionar longitute e latitude na tabela de espécies

### Join com as tabelas pela coluna "id"

```r
# join dos dados
sp_join &lt;- sp %&gt;% 
  left_join(si_coord, by = "id")
sp_join
```

---

# 4.7 dplyr

## **11 *_join**

## Adicionar longitute e latitude na tabela de espécies

### Nome das colunas

```r
colnames(sp_join)
```

---

# 4.7 dplyr

## **11 *_join**

## Adicionar longitute e latitude na tabela de espécies

### Nome das colunas

```r
sp_join %&gt;% 
  dplyr::select(species, longitude, latitude)
```

---

class: inverse, center, middle

# E não termina nunca...

---

# 4.7 dplyr

## Sufixos: _at(), _if(), _all()

### Realiza operações dependente de confições


```r
sp_wide_rename &lt;- sp_wide %&gt;% 
  dplyr::rename_at(vars(contains(" ")), 
                   list(~stringr::str_replace_all(., " ", "_"))) %&gt;% 
  dplyr::rename_all(list(~stringr::str_to_lower(.)))
sp_wide_rename
```

---

class: inverse, center, middle

# Mas o mais importante é a ideia de **encadeamento das funções**

---

# 4.7 dplyr
## Permite manipular os dados de forma simples

```r
da &lt;- si %&gt;% 
  dplyr::select(id, state_abbreviation, species_number)
da
```

---

# 4.7 dplyr
## Permite manipular os dados de forma simples

```r
da &lt;- si %&gt;% 
  dplyr::select(id, state_abbreviation, species_number) %&gt;% 
  dplyr::filter(species_number &gt; 5)
da
```

---

# 4.7 dplyr
## Permite manipular os dados de forma simples

```r
da &lt;- si %&gt;% 
  dplyr::select(id, state_abbreviation, species_number) %&gt;% 
  dplyr::filter(species_number &gt; 5) %&gt;% 
  dplyr::group_by(state_abbreviation) %&gt;% 
  dplyr::summarise(nsp_state_abb = n())
da
```

---

# 4.7 dplyr
## Permite manipular os dados de forma simples

```r
da &lt;- si %&gt;% 
  dplyr::select(id, state_abbreviation, species_number) %&gt;% 
  dplyr::filter(species_number &gt; 5) %&gt;% 
  dplyr::group_by(state_abbreviation) %&gt;% 
  dplyr::summarise(nsp_state_abb = n()) %&gt;% 
  dplyr::arrange(nsp_state_abb)
da
```

---

class: inverse, center, middle

# Exercícios

---

# Exercício 12

### Adicione essas novas colunas `alt_log, tem_log e pre_log`, que são a operação `log10` das colunas `altitude,	temperature e	precipitation` e atribua ao mesmo objeto `si` utilizando o formato tidyverse



---

# Exercício 12
## Solução

```r
# solucao
si &lt;- si %&gt;% 
  dplyr::mutate(alt_log = log10(altitude),
                tem_log = log10(temperature),
                pre_log = log10(precipitation))
si[, 25:28]
```

---

# Exercício 13

### Ordene os dados em forma decrescente pela coluna `altitude`, atribuindo o resultado a um novo objeto utilizando o formato tidyverse



---

# Exercício 13
## Solução

```r
# solucao
si_ar &lt;- si %&gt;% 
  dplyr::arrange(-altitude)
si_ar
```

---

# Exercício 14

###  Filtre as linhas com `altitude` maior que 1000 mm, `temperature` menor que 15 ºC e `precipitation` maior que 1000 mm, atribuindo o resultado a um novo objeto utilizando o formato tidyverse



---

# Exercício 14
## Solução

```r
# solucao
si_fi &lt;- si %&gt;% 
  dplyr::filter(altitude &gt; 1000,
                temperature &lt; 15,
                precipitation &gt; 1000)
si_fi
```

---

# Exercício 15

### Amostre 200 linhas aleatoriamente com número de espécies maior que 15 espécies, atribuindo o resultado a um novo objeto utilizando o formato tidyverse



---

# Exercício 15
## Solução

```r
# solucao
si_sa &lt;- si %&gt;% 
  dplyr::filter(species_number &gt; 15) %&gt;% 
  dplyr::sample_n(200)
si_sa
```

---

class: clear
background-image: url(img/package_stringr.png)
background-size: 400px

---

background-image: url(img/cheatsheet_stringr.png)
background-size: 600px
background-position: 50% 50%

# 4.8 stringr

## Work with Strings Cheatsheet

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://github.com/rstudio/cheatsheets/raw/master/strings.pdf

---

# 4.8 stringr

## Pacote para a manipulação de strings

### Comprimento

```r
stringr::str_length("abc")
```

--

### Extração por posição

```r
stringr::str_sub("abc", 3)
```

---

# 4.8 stringr

### Inserir espaço em branco - esquerda

```r
stringr::str_pad("abc", width = 4, side = "left")
```

--

### Inserir espaço em branco - direira

```r
stringr::str_pad("abc", width = 4, side = "right")
```

--

### Remover espaço em branco do começo, final ou ambos

```r
stringr::str_trim(" abc ")
```

---

# 4.8 stringr

### Minúsculas e maiúsculas

```r
stringr::str_to_upper("abc")
```
--

```r
stringr::str_to_title("abc")
```
--

```r
stringr::str_to_title("aBc")
```

---

# 4.8 stringr

### Ordenação

```r
le &lt;- sample(letters, 26, rep = TRUE)
le
```
--

```r
stringr::str_sort(le)
```
--

```r
stringr::str_sort(le, dec = TRUE)
```

---

# 4.8 stringr

### Extrair por padrão

```r
stringr::str_extract("abc", "b")
```

### Substituir

```r
stringr::str_replace("abc", "a", "y")
```

### Separação

```r
stringr::str_split("a-b-c", "-")
```

---

class: clear
background-image: url(img/package_forcats.png)
background-size: 400px

---

background-image: url(img/cheatsheet_forcats.png)
background-size: 600px
background-position: 50% 50%

# 4.9 forcats

## Factors with forcats Cheatsheet

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://github.com/rstudio/cheatsheets/raw/master/factors.pdf

---

# 4.9 forcats

### **as_factor()**: cria fatores

```r
# fixar amostragem
set.seed(42)

# cria um fator
fa &lt;- sample(c("alto", "medio", "baixo"), 30, rep = TRUE) %&gt;% 
  forcats::as_factor()
fa
```

---

# 4.9 forcats

### **fct_recode()**: muda o nome dos níveis

```r
# muda o nome dos niveis
fa_recode &lt;- fa %&gt;% 
  forcats::fct_recode(a = "alto", m = "medio", b = "baixo")
fa_recode
```

---

# 4.9 forcats

### **fct_rev()**: inverte os níveis

```r
# inverte os niveis
fa_rev &lt;- fa_recode %&gt;% 
  forcats::fct_rev()
fa_rev
```

---

# 4.9 forcats

### **fct_relevel()**: especifica a classificação de um ou mais níveis

```r
# especifica a classificacao de um nivel
fa_relevel &lt;- fa_recode %&gt;% 
  forcats::fct_relevel(c("a", "m", "b"))
fa_relevel
```

---

# 4.9 forcats

### **fct_inorder()**: ordem em que aparece

```r
# ordem em que aparece
fa_inorder &lt;- fa_recode %&gt;% 
  forcats::fct_inorder()
fa_inorder
```

---

# 4.9 forcats

### **fct_infreq()**: ordem (decrescente) de frequência

```r
# ordem (decrescente) de frequencia
fa_infreq &lt;- fa_recode %&gt;% 
  forcats::fct_infreq()
fa_infreq
```

---

# 4.9 forcats

### **fct_lump()**: agregação de níveis raros em um nível

```r
# agregacao de niveis raros em um nivel
fa_lump &lt;- fa_recode %&gt;% 
  forcats::fct_lump()
fa_lump
```

---

class: clear
background-image: url(img/package_lubridate.png)
background-size: 400px

---

class: clear
background-image: url(img/lubridate_allison.png)
background-size: 600px

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

Fonte: [@allison_horst](https://twitter.com/allison_horst)

---

background-image: url(img/cheatsheet_lubridate.png)
background-size: 600px
background-position: 50% 50%

# 4.10 lubridate

## Dates and Times Cheatsheet

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://github.com/rstudio/cheatsheets/raw/master/lubridate.pdf

---

# 4.10 lubridate

## Pacote à parte do tidyverse

### Instalar

```r
# install
install.packages("lubridate")
```

### Carregar

```r
# load
library(lubridate)
```

---

# 4.10 lubridate

### As funções `date()` e `as_date()` assumem que a ordem segue o padrão da língua inglesa: ano-mês-dia (ymd)

### **date**: classe para datas

```r
# string
data_string &lt;- "2020-04-24"
data_string
class(data_string)
```

---

# 4.10 lubridate

### As funções `date()` e `as_date()` assumem que a ordem segue o padrão da língua inglesa: ano-mês-dia (ymd)

### **date**: classe para datas

```r
# criar um objeto com a classe data
data_date &lt;- lubridate::date(data_string)
data_date
class(data_date)
```

---

# 4.10 lubridate

### As funções `date()` e `as_date()` assumem que a ordem segue o padrão da língua inglesa: ano-mês-dia (ymd)

### **date**: classe para datas

```r
# criar um objeto com a classe data
data_date &lt;- lubridate::as_date(data_string)
data_date
class(data_date)
```

---

# 4.10 lubridate

### Datas no padrão da língua portuguesa: dia-mês-ano (dmy)

### **date**: classe para datas

```r
# string
data_string &lt;- "20-10-2020"
data_string
class(data_string)
```

---

# 4.10 lubridate

### Datas no padrão da língua portuguesa: dia-mês-ano (dmy)

### **date**: classe para datas

```r
# criar um objeto com a classe data
data_date &lt;- lubridate::dmy(data_string)
data_date
class(data_date)
```

---

# 4.10 lubridate

### Além de outros diversos formatos


```r
# formatos
lubridate::dmy(20102020)
lubridate::dmy("20102020")
lubridate::dmy("20/10/2020")
lubridate::dmy("20.10.2020")
```

---

# 4.10 lubridate

### Especificar horários


```r
# especificar horarios
lubridate::dmy_h(2010202020)
lubridate::dmy_hm(201020202035)
lubridate::dmy_hms(20102020203535)
```

---

background-image: url(img/package_lubridate.png)
background-size: 300px
background-position: 80% 80%

# 4.10 lubridate

## Funções úteis
- second() - extrai os segundos
- minute() - extrai os minutos
- hour() - extrai a hora
- wday() - extrai o dia da semana
- mday() - extrai o dia do mês
- month() - extrai o mês
- year() - extrai o ano

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] http://material.curso-r.com/lubridate/

---

# 4.10 lubridate

### Extração

```r
# criar
data &lt;- lubridate::dmy_hms(20102020203535)
data
```
--

```r
# extrair
lubridate::second(data)
lubridate::day(data)
lubridate::month(data)
```

---

# 4.10 lubridate

### Extração

```r
# criar
data &lt;- lubridate::dmy_hms(20102020203535)
data
```


```r
# extrair
lubridate::wday(data)
lubridate::wday(data, label = TRUE)
```

---

# 4.10 lubridate

### Inclusão

```r
# criar
data &lt;- lubridate::dmy(20102020)
data
```


```r
# inlcuir
lubridate::hour(data) &lt;- 13
data
```

---

# 4.10 lubridate

### Extrair a data no instante da execução
&lt;br&gt;

```r
# extrair a data no instante da execucao
lubridate::today() 
```

--

&lt;br&gt;


```r
# extrair a data e horario no instante da execucao
lubridate::now()
```

quando eu preparava essa aula...

---

# 4.10 lubridate

### Fusos horários

```r
# agora
agora &lt;- lubridate::ymd_hms(lubridate::now(), tz = "America/Sao_Paulo")
agora
```
--

```r
# verificar os tz
OlsonNames()
```

---

# 4.10 lubridate

### Fusos horários

```r
# que horas sao em...
lubridate::with_tz(agora, tzone = "GMT")
lubridate::with_tz(agora, tzone = "Europe/Stockholm")  
```
--
&lt;br&gt;&lt;br&gt;

```r
# altera o fuso sem mudar a hora
lubridate::force_tz(agora, tzone = "GMT")
```

---

# 4.10 lubridate

## Operações com datas

### Intervalos
Intervalos podem ser salvos em objetos com classe interval

```r
# datas
inicio_r &lt;- lubridate::dmy("30-11-2011")
hoje_r &lt;- lubridate::today()

# intervalo
r_interval &lt;- lubridate::interval(inicio_r, hoje_r)
r_interval
class(r_interval)
```

---

# 4.10 lubridate

## Operações com datas

### Intervalos
Intersecção de intervalor com a função `int_overlaps()`


```r
# outra forma de definir um intervalo: o operador %--%
r_interval &lt;- lubridate::dmy("30-11-2011") %--% lubridate::today() 
namoro_interval &lt;- lubridate::dmy("25-06-2008") %--% lubridate::today()   
```
--

```r
# verificar sobreposicao
lubridate::int_overlaps(r_interval, namoro_interval)
```

---

# 4.10 lubridate

## Operações com datas

### Aritmética com datas

```r
# somando datas
inicio_r + lubridate::ddays(1)
inicio_r + lubridate::dyears(1)
```

---

# 4.10 lubridate

## Operações com datas

### Aritmética com datas

```r
# criando datas recorrentes
reunioes &lt;- lubridate::today() + lubridate::weeks(0:10)
reunioes
```

---

# 4.10 lubridate

## Operações com datas

### Aritmética com datas

```r
# duracao de um intervalo 
r_interval &lt;- inicio_r %--% lubridate::today()
r_interval
```
--

```r
# transformacoes
r_interval / lubridate::dyears(1)
r_interval / lubridate::ddays(1)
```

---

# 4.10 lubridate

## Operações com datas

### Aritmética com datas

```r
# total do periodo estudando r
lubridate::as.period(r_interval)
```
--

```r
# tempo de namoro
lubridate::as.period(namoro_interval)
```

---

class: clear
background-image: url(img/package_purrr.png)
background-size: 400px

---

background-image: url(img/cheatsheet_purrr.png)
background-size: 600px
background-position: 50% 50%

# 4.11 purrr

## Data Import Cheatsheet

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

[*] https://github.com/rstudio/cheatsheets/raw/master/purrr.pdf

---

# 4.11 purrr

### Pacote que implementa **Programação Funcional** 

--

&lt;br&gt;

### Uma função **chama outra função** para ser **aplicada repetidamente** percorrendo **elementos de um objeto** (vetor, lista ou data frame)

--

&lt;br&gt;

## Exemplos:
- Análise de experimento em vários locais 
- Análise de todas as respostas de um experimento
- Análise dos dados com diferentes transformações de variáveis
- Simulação computacional com diferentes delineamentos
- Importação de todos os datasets de um diretório

---

background-image: url(img/purrr_map.png)
background-size: 400px
background-position: 85% 90%

# 4.11 purrr

## A principal função é a `map*()` e sua "família"

&lt;br&gt;

## map(.x, .f)
### .x: uma vetor, lista ou data frame
### .f: uma função

---

# 4.11 purrr

## Aplicando uma função em série

```r
x &lt;- list(1:5, c(4, 5, 7), c(1, 1, 1), c(2, 2, 2, 2, 2))
```


```r
purrr::map(x, sum)
```

---

# 4.11 purrr

## Tipos de retorno

&lt;br&gt;&lt;br&gt;

|  map |  returns |
|:--|:--|
|`map()` | list |
|`map_chr()` | character vector |
|`map_dbl()` | double vector (numeric) |
|`map_int()` | integer vector |
|`map_lgl()` | logical vector |
|`map_dfc()` | data frame (by column) |
|`map_dfr()` | data frame (by row) |

---

# 4.11 purrr

&lt;br&gt;&lt;br&gt;

## Retorna double vector (numeric)

```r
purrr::map_dbl(x, sum)
```

&lt;br&gt;

--

## Retorna strings

```r
purrr::map_chr(x, paste, collapse = " ")
```

---

# 4.11 purrr

## Duas listas em paralelo

```r
x &lt;- list(3, 5, 0, 1)
y &lt;- list(3, 5, 0, 1)

purrr::map2_dbl(x, y, prod)
```

--

## Várias listas aninhadas

```r
x &lt;- list(3, 5, 0, 1)
y &lt;- list(3, 5, 0, 1)
z &lt;- list(3, 5, 0, 1)

purrr::pmap_dbl(list(x, y, z), prod)
```

---

# 4.11 purrr

### Calcular a média para várias colunas

```r
mean_var &lt;- si %&gt;% 
  dplyr::select(species_number, altitude) %&gt;% 
  purrr::map_dbl(mean)
mean_var
```

--

### Calcular o desvio padrão para várias colunas

```r
sd_var &lt;- si %&gt;% 
  dplyr::select(species_number, altitude) %&gt;% 
  purrr::map_dbl(sd)
sd_var
```

---

background-image: url(img/general_curso_r.png), url(img/person_jenny_bryan.jpeg)
background-size: 400px, 300px
background-position: 10% 70%, 90% 80%

# 4.11 purrr

## Material

### [Webinar de purrr avançado](https://youtu.be/vb1lD9_AFcU) - Curso-R

### [purrr tutorial](https://jennybc.github.io/purrr-tutorial/) - Jennifer (Jenny) Bryan

---

class: inverse, center, middle

# Leitura

---

background-image: url(img/geo_geoprocessing02.png)
background-size: 800px
background-position: 50% 40%

# Leitura

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

*[http://www.ufrrj.br/lga/tiagomarino/artigos/oqueegeoprocessamento.pdf]

---

class: inverse, center, middle

# Dúvidas?

---

class: clear, middle

&lt;br&gt;&lt;br&gt;&lt;br&gt;

## Maurício Vancine

&lt;br&gt;

Contatos:

<i class="fas  fa-envelope " style="color:#0000ee;"></i> [mauricio.vancine@gmail.com]()
&lt;br&gt;
<i class="fab  fa-twitter " style="color:#0000ee;"></i> [@mauriciovancine](https://twitter.com/mauriciovancine)
&lt;br&gt;
<i class="fab  fa-github " style="color:#0000ee;"></i> [mauriciovancine](https://mauriciovancine.netlify.com/)
&lt;br&gt;
<i class="fas  fa-link " style="color:#0000ee;"></i> [mauriciovancine.netlify.com](https://mauriciovancine.netlify.com/)

&lt;br&gt;&lt;br&gt;&lt;br&gt;

Slides criados via pacote [xaringan](https://github.com/yihui/xaringan) e tema [Metropolis](https://github.com/pat-s/xaringan-metropolis)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "rainbow",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
